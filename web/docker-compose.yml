version: '3'

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - '${BASE_PORT:-2006}:3000'
    depends_on:
      - mongo
    environment:
      ROOT_URL: ${APP_ROOT_URL:-http://localhost}
      MONGO_URL: ${MONGO_URL:-mongodb://mongo:27017/meteor}
      MONGO_OPLOG_URL: ${MONGO_URL:-mongodb://mongo:27017/local}
      PORT: 3000
      METEOR_SETTINGS: >
        {
          "nounProject": {
            "key": "${NOUN_PROJECT_KEY}",
            "secret": "${NOUN_PROJECT_SECRET}"
          },
          "monti": {
            "appId": ${MONTI_APP_ID},
            "appSecret": ${MONTI_APP_SECRET},
          },
          "stripePrivateKey": ${STRIPE_PRIVATE_KEY},
          "mailGun": {
            "server": "${MAIL_URL}"
          },
          "public": {
            "env": "${SB_ENV:-prod}",
            "baseUrl": "${APP_ROOT_URL:-https://app.slatebox.com}",
            "stripePublicKey": "${STRIPE_PUBLIC_KEY}",
            "googleFontAPIKey": "${GOOGLE_API_KEY}",
            "googleImageSearchEngineKey": "${GOOGLE_IMAGE_SEARCH_API_KEY}",
            "googleImageSearchAPIKey": "${GOOGLE_API_KEY}",
            "heapIOKey": "${HEAP_IO_KEY}",
            "pixabayAPIKey": "${PIXABAY_API_KEY}"
          }
        }
  mongo:
    image: mongo:latest
    command:
      - --storageEngine=wiredTiger
    volumes:
      - data:/data/db

volumes:
  data: